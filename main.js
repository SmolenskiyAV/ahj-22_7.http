(()=>{"use strict";function e(e,t,n,s){e.open(`${t}`,`http://localhost:7070/?method=${n}`),"POST"===t&&"statusTicket"===n?e.send(JSON.stringify(s)):e.send(s)}function t(e){e.querySelector("input").value="",e.querySelector("textarea").value=""}function n(e,t){alert(`answer = ${t}`),console.log("response = ",e.response)}function s(e,t,n,s,i,a){let l="";"true"===n&&(l="&#10004;"),e.insertAdjacentHTML("afterbegin",`\n  <div class="task">\n    <span class="visually-hidden operable" name = "id">${t}</span>\n    <div class="task__title">\n      <div style="padding: 9px;">\n          <span class="visually-hidden" name = "status">${n}</span>\n          <p class="tiket__done">${l}</p>\n      </div>\n      <p class="tiket_text operable" name = "name">${s}</p>\n      <div class="right_block">\n          <p class="tiket__date operable" name = "created">${i}</p>\n          <p class="tiket__change">&#9998;</p>\n          <p class="tiket__remove">&times;</p>\n      </div>\n    </div>\n    <div>\n      <div class="tiket__textarea display_none operable" name = "description">${a}</div>\n    </div>\n  </div>`)}document.addEventListener("DOMContentLoaded",(()=>{const i=document.getElementById("tiket__add"),a=document.getElementById("Add_Tiket_Form"),l=document.getElementById("AddForm"),c=document.getElementById("Change_Tiket_Form"),r=document.getElementById("ChangeForm"),o=document.getElementById("Delete_Tiket_Form"),d=document.getElementById("tikets__list"),u=document.querySelector(".content");let p="",m="",v="",L="",_="",k="",E="",y="";i.addEventListener("submit",(e=>{e.preventDefault()})),a.addEventListener("submit",(e=>{e.preventDefault()})),c.addEventListener("submit",(e=>{e.preventDefault()})),o.addEventListener("submit",(e=>{e.preventDefault()}));const g=new XMLHttpRequest;e(g,"GET","allTickets"),g.addEventListener("load",(()=>{if(g.status>=200&&g.status<300)try{let t=g.getResponseHeader("X-MARKER"),i={};switch(null===t&&(t="not markered data"),t){case"allTickets":p=[...JSON.parse(g.responseText)],d.innerHTML="";for(let e=0;e<p.length;e++){const{id:t}=p[e],{status:n}=p[e],{name:i}=p[e],{created:a}=p[e],{description:l}=p[e];void 0!==i&&void 0!==t&&void 0!==a&&s(d,t,n,i,a,l)}return;case"Ticket added!":return n(g,t),void e(g,"GET","allTickets");case"Ticket deleted!":return n(g,t),void m.parentElement.remove();case"status changed!":return void n(g,t);case"Ticket edited!":return i=JSON.parse(g.response),n(g,t),y.querySelector(".tiket_text").innerHTML=i.name,void(y.querySelector(".tiket__textarea").innerHTML=i.description);default:return void(g.response.status=404)}}catch(e){console.error(e),alert(`Ошибка ${g.status}: ${g.statusText}`)}})),u.addEventListener("click",(n=>{const{target:s}=n;if(!s.classList.contains("status")&&!s.classList.contains("right_block")&&!s.classList.contains("tiket__change")&&!s.classList.contains("tiket__remove")&&!s.classList.contains("tiket__date")&&!s.classList.contains("tiket_text")&&s.nextElementSibling){const e=s.nextElementSibling.firstElementChild;e.classList.contains("display_none")?e.classList.remove("display_none"):e.classList.add("display_none")}if(s.classList.contains("tiket__textarea")&&s.classList.add("display_none"),s.classList.contains("tiket__remove")&&(m=s.parentElement.parentElement.previousElementSibling,v=m.textContent,o.classList.remove("display_none"),o.addEventListener("click",(function t(n){const{target:s}=n;s.classList.contains("Cancel")&&(o.classList.add("display_none"),o.removeEventListener("click",t)),s.classList.contains("Ok")&&(e(g,"POST","deletTicket",v),o.removeEventListener("click",t),o.classList.add("display_none"))}))),s.classList.contains("tiket__done")){const t=s.previousElementSibling;m=s.parentElement.parentElement.previousElementSibling,v=m.textContent,""===s.innerHTML?(s.innerHTML="&#10004;",t.innerHTML=!0):(s.innerHTML="",t.innerHTML=!1);const n=t.innerHTML;e(g,"POST","statusTicket",{id:v,status:n})}s.classList.contains("tiket__change")&&(m=s.parentElement.parentElement.previousElementSibling,v=m.textContent,L=s.parentElement.previousElementSibling,_=L.textContent,k=s.parentElement.parentElement.nextElementSibling.firstElementChild,E=k.textContent,c.classList.remove("display_none"),c.querySelector("input").value=_,c.querySelector("textarea").value=E,c.addEventListener("click",(function n(s){const{target:i}=s;if(i.classList.contains("Cancel")&&(c.classList.add("display_none"),c.removeEventListener("click",n),t(c)),i.classList.contains("Ok")){if(""===c.querySelector("input").value)return void alert('Заполни поле "Краткое описание"!');const s=new FormData(r);s.append("id",`${v}`),e(g,"POST","editTicket",s),y=m.parentElement,t(c),c.removeEventListener("click",n),c.classList.add("display_none")}})))})),i.addEventListener("click",(()=>{a.classList.remove("display_none"),a.addEventListener("click",(function n(s){const{target:i}=s;if(i.classList.contains("Cancel")&&(a.classList.add("display_none"),a.removeEventListener("click",n),t(l)),i.classList.contains("Ok")){if(""===l.querySelector("input").value)return void alert('Заполни поле "Краткое описание"!');const s=new FormData(l);e(g,"POST","createTicket",s),t(l),a.removeEventListener("click",n),a.classList.add("display_none")}}))}))}))})();